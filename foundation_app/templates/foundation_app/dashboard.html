{% extends 'foundation_app/base.html' %}
{% load static %}
{% block title %}Dashboard - Puranchand Foundation{% endblock %}
{% block content %}
<section class="font-sans text-gray-800 py-16 px-4 md:px-8 bg-emerald-50 min-h-screen">
<div class="container mx-auto">
<div class="flex flex-col items-center justify-center text-center mb-12">
<div class="mb-4">
<svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M50 0L25 25V75L50 100L75 75V25L50 0Z" fill="#065F46"/>
<path d="M50 50L75 25L50 0L25 25V50" stroke="white" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M50 50L25 75L50 100L75 75V50" stroke="white" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M50 50L75 75M50 50L25 75" stroke="white" stroke-width="5" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</div>
<h2 class="text-4xl font-extrabold text-emerald-800">Your Dashboard</h2>
</div>
<div class="bg-white p-8 rounded-xl shadow-2xl border border-emerald-100">
{% if user.is_authenticated %}
{% if messages %}
    <div class="mb-8">
        {% for message in messages %}
            <div class="bg-green-100 border-l-4 border-green-500 text-green-700 p-4 rounded-md shadow-md" role="alert">
                <p class="font-bold">Success!</p>
                <p>{{ message }}</p>
            </div>
        {% endfor %}
    </div>
{% endif %}
<p class="text-lg text-gray-700 mb-6 text-center">
Welcome to your personalized dashboard, <span class="font-semibold text-emerald-700">{% if user.first_name and user.last_name %}{{ user.first_name }} {{ user.last_name }}{% else %}{{ user.username }}{% endif %}</span>!
This is where you can track your impact, manage donations, and view reports.
</p>
<div class="flex flex-col sm:flex-row border-b border-gray-200 mb-8 space-y-2 sm:space-y-0 sm:space-x-4 overflow-x-auto pb-2">
<button
class="tab-button whitespace-nowrap px-6 py-3 text-lg font-medium rounded-t-lg transition-all duration-300 ease-in-out text-gray-700 hover:text-emerald-600 border-b-2 border-transparent focus:outline-none active-tab"
data-tab="overview"
>
Overview
</button>
<button
class="tab-button whitespace-nowrap px-6 py-3 text-lg font-medium rounded-t-lg transition-all duration-300 ease-in-out text-gray-700 hover:text-emerald-600 border-b-2 border-transparent focus:outline-none"
data-tab="make-donation"
>
Make a Donation
</button>
<button
class="tab-button whitespace-nowrap px-6 py-3 text-lg font-medium rounded-t-lg transition-all duration-300 ease-in-out text-gray-700 hover:text-emerald-600 border-b-2 border-transparent focus:outline-none"
data-tab="volunteer"
>
Become a Volunteer
</button>
<button
class="tab-button whitespace-nowrap px-6 py-3 text-lg font-medium rounded-t-lg transition-all duration-300 ease-in-out text-gray-700 hover:text-emerald-600 border-b-2 border-transparent focus:outline-none"
data-tab="fundraise"
>
Quick Fundraise
</button>
<button
class="tab-button whitespace-nowrap px-6 py-3 text-lg font-medium rounded-t-lg transition-all duration-300 ease-in-out text-gray-700 hover:text-emerald-600 border-b-2 border-transparent focus:outline-none"
data-tab="help-someone"
>
Help Someone
</button>
</div>
<div id="tab-content-overview" class="tab-content active-content">
<div id="overview-cards" class="grid grid-cols-1 md:grid-cols-2 gap-8">
<div class="bg-gradient-to-br from-emerald-100 to-emerald-200 p-6 rounded-lg shadow-lg border border-emerald-300 transform hover:scale-105 transition-transform duration-300">
<h3 class="text-2xl font-bold text-emerald-800 mb-4 flex items-center">
<svg class="w-8 h-8 text-emerald-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 8v8m-4-4v4m-4-4v4m-2 2h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
</svg>
Overview
</h3>
<p class="text-gray-700 text-lg">
See a snapshot of your engagement and contributions. Track your impact on various foundation initiatives.
</p>
<button id="view-full-report-button"
class="mt-4 bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-2 px-6 rounded-full text-md shadow transition-all duration-300 ease-in-out transform hover:scale-105">
View Full Report
</button>
</div>
<div class="bg-gradient-to-br from-teal-100 to-teal-200 p-6 rounded-lg shadow-lg border border-teal-300 transform hover:scale-105 transition-transform duration-300">
<h3 class="text-2xl font-bold text-teal-800 mb-4 flex items-center">
<svg class="w-8 h-8 text-teal-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2z"></path>
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10.75V14.25m0 0a2 2 0 100 4m0-4.5L14 12m-2-1.25V9.75m0 0a2 2 0 100-4m0 4.5L10 12"></path>
</svg>
Foundation Highlights
</h3>
<ul class="list-disc list-inside text-gray-700 text-lg space-y-2">
<li>New Education Scholarship Program launched.</li>
<li>Partnership with Global NGO for Clean Energy.</li>
<li>..</li>
<li>..</li>
</ul>
<button class="mt-4 bg-teal-600 hover:bg-teal-700 text-white font-semibold py-2 px-6 rounded-full text-md shadow transition-all duration-300 ease-in-out transform hover:scale-105">
Learn More
</button>
</div>
</div>
<div id="detailed-report" class="mt-8 p-6 bg-gradient-to-br from-emerald-50 to-emerald-100 rounded-lg shadow-lg border border-emerald-200 hidden">
<h3 class="text-3xl font-bold text-emerald-800 mb-6">Detailed Impact Report</h3>
<p class="text-lg text-gray-700 mb-4">
Here you can find a more comprehensive breakdown of your contributions and the foundation's overall impact.
</p>
<div class="space-y-4 mb-6">
<div class="bg-white p-4 rounded-md shadow-sm border border-emerald-100">
<p class="font-semibold text-xl text-emerald-700 mb-1">Total Donations:</p>
<p class="text-gray-800 text-lg">{{ personalized_data.total_donations }}</p>
</div>
<div class="bg-white p-4 rounded-md shadow-sm border border-emerald-100">
<p class="font-semibold text-xl text-emerald-700 mb-1">Projects Supported:</p>
<ul class="list-disc list-inside text-gray-800 text-lg">
{% for project in personalized_data.projects_supported %}
<li>{{ project }}</li>
{% endfor %}
</ul>
</div>
<div class="bg-white p-4 rounded-md shadow-sm border border-emerald-100">
<p class="font-semibold text-xl text-emerald-700 mb-1">Volunteer Hours:</p>
<p class="text-gray-800 text-lg">{{ personalized_data.volunteer_hours }}</p>
</div>
</div>
<button id="back-to-overview-button"
class="bg-emerald-600 hover:bg-emerald-700 text-white font-semibold py-2 px-6 rounded-full text-md shadow transition-all duration-300 ease-in-out transform hover:scale-105">
Back to Dashboard Overview
</button>
</div>
</div>
<div id="tab-content-make-donation" class="tab-content hidden">
<h3 class="text-3xl font-bold text-emerald-700 mb-6 text-center">Give a Single Gift</h3>
<p class="text-lg text-gray-700 mb-8 text-center">
Your generous donations fuel our initiatives and help us reach more communities. Every contribution, big or small, makes a difference.
</p>
<div class="grid grid-cols-1 place-items-center">
<div class="bg-white p-8 rounded-xl shadow-xl hover:shadow-2xl transition-shadow duration-300 border border-emerald-100 flex flex-col items-center text-center max-w-md w-full">
<div class="text-emerald-600 text-5xl mb-6 flex justify-center">
<svg class="w-16 h-16" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.6 15.6a1.5 1.5 0 00-2.12.01l-1.42 1.42a1.5 1.5 0 01-2.12 0l-1.42-1.42a1.5 1.5 0 00-2.12-.01L6 14.8V12h3a1.5 1.5 0 000-3h-3V6l2.12-2.12a1.5 1.5 0 012.12 0l1.42 1.42a1.5 1.5 0 002.12 0l1.42-1.42a1.5 1.5 0 012.12 0L22 6v6h-3a1.5 1.5 0 000 3h3v3.172l-2.12-2.12z"></path>
</svg>
</div>
<h3 class="text-2xl font-bold text-emerald-700 mb-4">Make a Contribution Today</h3>
<p class="text-gray-700 text-lg leading-relaxed mb-4">
Support our ongoing projects with a one-time financial gift.
</p>
<div class="min-h-screen flex items-center justify-center bg-emerald-50">
    <div class="bg-white p-8 rounded-xl shadow-xl text-center">
        <h2 class="text-2xl font-bold mb-6">Make a Contribution Today</h2>
        <p class="mb-4 text-gray-600">Support our ongoing projects with a one-time financial gift.</p>
        
        <input type="number" id="donation-amount" 
            placeholder="Enter Donation Amount (â‚¹)" 
            class="border p-3 rounded w-full mb-4 text-center">

        <button id="rzp-button1" 
            class="bg-emerald-600 hover:bg-emerald-700 text-white px-6 py-3 rounded-full text-lg shadow-md">
            Donate Now
        </button>
    </div>
</div>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
    document.getElementById('rzp-button1').onclick = function(e){
        e.preventDefault();

        var amount = document.getElementById('donation-amount').value * 100;  // convert to paise

        if(!amount || amount < 100){
            alert("Please enter a valid donation amount (minimum â‚¹1).");
            return;
        }

        var options = {
            "key": "{{ key_id }}",  // Pass from Django context
            "amount": amount,
            "currency": "INR",
            "name": "Puranchand Foundation",
            "description": "Donation",
            "handler": function (response){
                alert("Payment successful! Payment ID: " + response.razorpay_payment_id);
                // Optional: Send response.razorpay_payment_id to backend via AJAX for verification
            },
            "theme": {
                "color": "#059669"
            }
        };
        var rzp1 = new Razorpay(options);
        rzp1.open();
    }
</script>


</div>
</div>
</div>
<div id="tab-content-volunteer" class="tab-content hidden">
<h3 class="text-3xl font-bold text-emerald-700 mb-6 text-center">Become a Volunteer</h3>
<p class="text-lg text-gray-700 mb-8 text-center">
Sign up to join our team of dedicated volunteers and make a direct impact in your community.
</p>
<div class="max-w-xl mx-auto p-8 rounded-xl shadow-xl border border-emerald-100 bg-emerald-50">
<form method="post" action="{% url 'foundation_app:volunteer_submit' %}" class="space-y-6">
{% csrf_token %}
<div class="space-y-4">
<div>
<label for="{{ volunteer_form.full_name.id_for_label }}" class="block text-sm font-medium text-gray-700">Full name:</label>
{{ volunteer_form.full_name }}
</div>
<div>
<label for="{{ volunteer_form.email.id_for_label }}" class="block text-sm font-medium text-gray-700">Email:</label>
{{ volunteer_form.email }}
</div>
<div>
<label for="{{ volunteer_form.phone.id_for_label }}" class="block text-sm font-medium text-gray-700">Phone:</label>
{{ volunteer_form.phone }}
</div>
<div>
<label for="{{ volunteer_form.availability.id_for_label }}" class="block text-sm font-medium text-gray-700">Availability:</label>
<p class="text-xs text-gray-500 mb-1">Availability of the volunteer (e.g., Weekends, Weekdays, Full-time)</p>
{{ volunteer_form.availability }}
</div>
<div>
<label for="{{ volunteer_form.message.id_for_label }}" class="block text-sm font-medium text-gray-700">Message:</label>
<p class="text-xs text-gray-500 mb-1">Why do you want to volunteer?</p>
{{ volunteer_form.message }}
</div>
</div>
<div class="text-center">
<button type="submit" class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-8 rounded-full text-md shadow transition-all duration-300 ease-in-out transform hover:scale-105">
Submit
</button>
</div>
</form>
</div>
<hr class="my-8 border-gray-200">
<div class="p-8 rounded-xl shadow-xl border border-emerald-100 bg-emerald-50">
<h4 class="text-2xl font-bold text-emerald-800 mb-4 text-center">Our Volunteers</h4>
{% if volunteers %}
<ul class="list-disc list-inside text-gray-700 text-lg space-y-2">
{% for volunteer in volunteers %}
<li>{{ volunteer.full_name }} ({{ volunteer.email }})</li>
{% endfor %}
</ul>
{% else %}
<p class="text-gray-700 text-lg text-center">No volunteers registered yet.</p>
{% endif %}
</div>
</div>
<div id="tab-content-fundraise" class="tab-content hidden">
<h3 class="text-3xl font-bold text-orange-700 mb-6 text-center">Start Your Own Fundraiser!</h3>
<p class="text-lg text-gray-700 mb-8 text-center">
Empower others by launching a quick fundraising campaign for a cause you care about.
</p>
<div class="max-w-xl mx-auto p-8 rounded-xl shadow-xl border border-orange-100 bg-orange-50">
<div class="text-orange-600 text-5xl mb-6 flex justify-center">
<svg class="w-16 h-16" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c1.657 0 3 1.343 3 3v4a2 2 0 01-2 2h-2a2 2 0 01-2-2v-4c0-1.657 1.343-3 3-3z"></path>
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8V6a4 4 0 00-4 4v2a2 2 0 002 2h4a2 2 0 002-2v-2a4 4 0 00-4-4z"></path>
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 10h-2M6 10H4"></path>
</svg>
</div>
<form action="{% url 'foundation_app:dashboard' %}" method="post" class="space-y-6">
    {% csrf_token %}
    <div>
        <label for="{{ campaign_form.title.id_for_label }}" class="block text-sm font-medium text-gray-700">Campaign Title</label>
        {{ campaign_form.title }}
    </div>
    <div>
        <label for="{{ campaign_form.goal_amount.id_for_label }}" class="block text-sm font-medium text-gray-700">Goal Amount (â‚¹)</label>
        {{ campaign_form.goal_amount }}
    </div>
    <div>
        <label for="{{ campaign_form.description.id_for_label }}" class="block text-sm font-medium text-gray-700">Campaign Description</label>
        {{ campaign_form.description }}
    </div>
    <div class="text-center">
        <button type="submit" name="launch_campaign"
            class="bg-orange-600 hover:bg-orange-700 text-white font-bold py-3 px-8 rounded-full text-md shadow transition-all duration-300 ease-in-out transform hover:scale-105">
            Launch Campaign
        </button>
    </div>
</form>

</div>
</div>
<div id="tab-content-help-someone" class="tab-content hidden">
<h3 class="text-3xl font-bold text-teal-700 mb-6 text-center">Find Ways to Help Someone Today</h3>
<p class="text-lg text-gray-700 mb-8 text-center">
Discover immediate opportunities to lend a hand and directly impact lives.
</p>
<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    {% if campaigns %}
        {% for campaign in campaigns %}
            <div class="bg-white p-6 rounded-xl shadow-lg border border-teal-100 flex flex-col items-start justify-center text-left">
                <h4 class="text-2xl font-bold text-teal-800 mb-2">{{ campaign.title }}</h4>
                <p class="text-gray-700 mb-4">{{ campaign.description }}</p>
                <div class="w-full bg-gray-200 rounded-full h-2.5 mb-4">
                    <div class="bg-teal-600 h-2.5 rounded-full" style="width: {{ campaign.progress_percentage }}%;"></div>
                </div>
                <p class="text-lg font-semibold text-gray-900">Goal: â‚¹{{ campaign.goal_amount }}</p>
                <p class="text-sm text-gray-500 mt-1">Raised: â‚¹{{ campaign.raised_amount|default:"0" }}</p>
               <button
    class="donate-button mt-4 bg-teal-600 hover:bg-teal-700 text-white font-bold py-2 px-6 rounded-full text-md shadow transition-all duration-300 ease-in-out transform hover:scale-105"
    data-campaign="{{ campaign.id }}"
    data-title="{{ campaign.title }}"
    data-goal="{{ campaign.goal_amount }}">
    Donate Now
</button>

            </div>
        {% endfor %}
    {% else %}
        <div class="md:col-span-2 text-center p-8 bg-white rounded-xl shadow-lg border border-teal-100">
            <h4 class="text-xl font-semibold text-gray-700 mb-2">No active fundraising campaigns yet.</h4>
            <p class="text-md text-gray-500">Be the first to <a href="#" data-tab-trigger="fundraise" class="text-orange-600 hover:text-orange-700 underline">launch a new campaign</a>!</p>
        </div>
    {% endif %}
</div>
</div>
<div class="flex justify-center mt-8">
<form method="post" action="{% url 'foundation_app:logout' %}">
{% csrf_token %}
<button type="submit"
class="bg-red-600 hover:bg-red-700 text-white text-base font-semibold py-2 px-6 rounded-full shadow-md transition-all duration-300">
Logout
</button>
</form>
</div>
{% else %}
<div class="max-w-md mx-auto bg-white p-8 rounded-xl shadow-2xl border border-emerald-100 text-center">
<h3 class="text-3xl font-bold text-emerald-800 mb-6">Access Restricted</h3>
<p class="text-lg text-gray-700 mb-8">
Please log in or sign up to view your personalized dashboard and full reports.
</p>
<div class="flex flex-col space-y-4">
<a href="{% url 'login' %}"
class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 px-6 rounded-full text-xl shadow-lg transition-all duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-emerald-300">
Login
</a>
<a href="{% url 'signup' %}"
class="w-full bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-3 px-6 rounded-full text-xl shadow-lg transition-all duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-gray-400">
Sign Up
</a>
</div>
</div>
{% endif %}
</div>
</div>
</section>
<style>
.active-tab {
border-bottom: 2px solid var(--tw-colors-emerald-600);
}
</style>
<script>
document.addEventListener('DOMContentLoaded', () => {
const tabButtons = document.querySelectorAll('.tab-button');
const tabContents = document.querySelectorAll('.tab-content');
const overviewCards = document.getElementById('overview-cards');
const detailedReport = document.getElementById('detailed-report');
const viewFullReportButton = document.getElementById('view-full-report-button');
const backToOverviewButton = document.getElementById('back-to-overview-button');
const activeTabClass = 'active-tab';
const setActiveTab = (selectedButton) => {
tabButtons.forEach(btn => {
btn.classList.remove(activeTabClass);
btn.classList.remove('text-emerald-800', 'bg-white', 'shadow-md');
btn.classList.add('text-gray-700');
});
tabContents.forEach(content => content.classList.add('hidden'));
selectedButton.classList.add(activeTabClass);
selectedButton.classList.add('text-emerald-800', 'bg-white', 'shadow-md');
selectedButton.classList.remove('text-gray-700');
const targetTabId = selectedButton.dataset.tab;
document.getElementById(`tab-content-${targetTabId}`).classList.remove('hidden');
if (targetTabId !== 'overview') {
if (overviewCards) overviewCards.classList.remove('hidden');
if (detailedReport) detailedReport.classList.add('hidden');
}
};
tabButtons.forEach(button => {
button.addEventListener('click', () => {
setActiveTab(button);
});
});
if (viewFullReportButton) {
viewFullReportButton.addEventListener('click', () => {
if (overviewCards) overviewCards.classList.add('hidden');
if (detailedReport) detailedReport.classList.remove('hidden');
});
}
if (backToOverviewButton) {
backToOverviewButton.addEventListener('click', () => {
if (detailedReport) detailedReport.classList.add('hidden');
if (overviewCards) overviewCards.classList.remove('hidden');
});
}
const initialTab = document.querySelector(`[data-tab="overview"]`);
if (initialTab) {
setActiveTab(initialTab);
}
// New JavaScript for clicking the "launch a new campaign" link
const fundraiseLink = document.querySelector('[data-tab-trigger="fundraise"]');
if (fundraiseLink) {
    fundraiseLink.addEventListener('click', (e) => {
        e.preventDefault();
        const fundraiseButton = document.querySelector('[data-tab="fundraise"]');
        if (fundraiseButton) {
            setActiveTab(fundraiseButton);
        }
    });
}
});
</script>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
document.querySelectorAll('.donate-button').forEach(button => {
    button.addEventListener('click', function(e) {
        e.preventDefault();

        let campaignTitle = this.dataset.title;
        let campaignGoal = parseInt(this.dataset.goal);
        let raisedSoFar = parseInt(this.dataset.raised || 0);  // weâ€™ll pass this in template
        let remaining = campaignGoal - raisedSoFar;

        if (remaining <= 0) {
            alert("This campaign has already reached its goal ðŸŽ‰");
            return;
        }

        // Ask user for donation amount
        let amount = prompt("Enter donation amount (â‚¹) for " + campaignTitle + "\nGoal Remaining: â‚¹" + remaining);

        if (!amount || isNaN(amount) || amount < 1) {
            alert("Please enter a valid amount.");
            return;
        }

        amount = parseInt(amount);

        if (amount > remaining) {
            alert("You can only donate up to â‚¹" + remaining + " for this campaign.");
            return;
        }

        let options = {
            "key": "{{ key_id }}",
            "amount": amount * 100,  // in paise
            "currency": "INR",
            "name": "Puranchand Foundation",
            "description": "Donation to " + campaignTitle,
            "handler": function (response){
                alert("Payment successful! Payment ID: " + response.razorpay_payment_id);
                // TODO: Send to backend via AJAX to update campaign
            },
            "theme": { "color": "#059669" }
        };

        let rzp1 = new Razorpay(options);
        rzp1.open();
    });
});
</script>

{% endblock %}
